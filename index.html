<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Telegram Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary-color: #6C5CE7;
      --primary-hover: #5649C0;
      --secondary-color: #00B894;
      --error-color: #D63031;
      --text-color: var(--tg-theme-text-color, #2D3436);
      --bg-color: var(--tg-theme-bg-color, #F5F6FA);
      --button-text-color: #FFFFFF;
      --border-radius: 16px;
      --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 24px;
      box-sizing: border-box;
      transition: background-color 0.3s ease;
    }

    #greeting {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 32px;
      text-align: center;
      user-select: none;
      width: 100%;
      max-width: 400px;
      color: var(--text-color);
    }

    .buttons, .submenu, .form-container {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 400px;
      width: 100%;
      margin-bottom: 16px;
    }

    button {
      flex: 1 1 calc(50% - 8px);
      min-width: 140px;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      background-color: var(--primary-color);
      color: var(--button-text-color);
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      user-select: none;
    }

    button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .icon {
      font-size: 20px;
      user-select: none;
      pointer-events: none;
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
    #lunch { background-color: #00B894; }
    #lunch:hover { background-color: #00A884; }
    
    #salary { background-color: #FDCB6E; color: #2D3436; }
    #salary:hover { background-color: #FFB347; }
    
    #chat { background-color: #0984E3; }
    #chat:hover { background-color: #0771C1; }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º */
    .form-container {
      flex-direction: column;
      align-items: stretch;
      background: var(--tg-theme-secondary-bg-color, #FFFFFF);
      padding: 24px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      user-select: none;
      color: var(--text-color);
    }

    input[type="date"], select {
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 12px;
      border: 2px solid var(--tg-theme-hint-color, #DFE6E9);
      width: 100%;
      box-sizing: border-box;
      background-color: var(--tg-theme-bg-color, #FFFFFF);
      color: var(--text-color);
      margin-bottom: 16px;
    }

    input[type="date"]:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .error {
      color: var(--error-color);
      font-weight: 600;
      margin: 8px 0;
      user-select: none;
      font-size: 14px;
    }

    .hidden {
      display: none !important;
    }

    .back-btn {
      margin-top: 8px;
      background-color: var(--tg-theme-secondary-bg-color, #636E72);
      color: var(--tg-theme-button-text-color, #FFFFFF);
      flex: none;
      width: 100%;
      border-radius: 12px;
    }

    .back-btn:hover {
      background-color: var(--tg-theme-secondary-bg-color, #555F61);
      transform: none;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .buttons, .submenu, .form-container {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <h1 id="greeting">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
  <div id="main-buttons" class="buttons">
    <button id="vacation"><span class="icon">‚úàÔ∏è</span> –û—Ç–ø—É—Å–∫</button>
    <button id="lunch"><span class="icon">üçΩÔ∏è</span> –û–±–µ–¥</button>
    <button id="salary"><span class="icon">üí∞</span> –ó–∞—Ä–ø–ª–∞—Ç–∞</button>
    <button id="chat"><span class="icon">üí¨</span> –ß–∞—Ç</button>
  </div>

  <!-- –ü–æ–¥–º–µ–Ω—é –¥–ª—è –æ–±–µ–¥–∞ -->
  <div id="lunch-menu" class="submenu hidden">
    <button data-dish="–ú–∞–∫–∞—Ä–æ–Ω—ã"><span class="icon">üçù</span> –ú–∞–∫–∞—Ä–æ–Ω—ã</button>
    <button data-dish="–ü–ª–æ–≤"><span class="icon">üçö</span> –ü–ª–æ–≤</button>
    <button data-dish="–°—É–ø"><span class="icon">ü•£</span> –°—É–ø</button>
    <button data-dish="–ë—É—Ä–≥–µ—Ä"><span class="icon">üçî</span> –ë—É—Ä–≥–µ—Ä</button>
    <button id="lunch-back" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—É—Å–∫–∞ -->
  <div id="vacation-form" class="form-container hidden">
    <label for="start-date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–ø—É—Å–∫–∞:</label>
    <input type="date" id="start-date" />
    
    <label for="end-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ—Ç–ø—É—Å–∫–∞:</label>
    <input type="date" id="end-date" />
    
    <div id="vacation-error" class="error hidden"></div>
    <button id="vacation-submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <button id="vacation-back" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –í—ã–±–æ—Ä –≥–æ–¥–∞ –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç—ã -->
  <div id="salary-year" class="submenu hidden">
    <!-- –ö–Ω–æ–ø–∫–∏ –≥–æ–¥–æ–≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤ JS -->
    <button id="salary-year-back" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <!-- –í—ã–±–æ—Ä –º–µ—Å—è—Ü–∞ –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç—ã -->
  <div id="salary-month" class="submenu hidden">
    <button data-month="–Ø–Ω–≤–∞—Ä—å"><span class="icon">‚ùÑÔ∏è</span> –Ø–Ω–≤–∞—Ä—å</button>
    <button data-month="–§–µ–≤—Ä–∞–ª—å"><span class="icon">üå®Ô∏è</span> –§–µ–≤—Ä–∞–ª—å</button>
    <button data-month="–ú–∞—Ä—Ç"><span class="icon">üå∑</span> –ú–∞—Ä—Ç</button>
    <button data-month="–ê–ø—Ä–µ–ª—å"><span class="icon">üåßÔ∏è</span> –ê–ø—Ä–µ–ª—å</button>
    <button data-month="–ú–∞–π"><span class="icon">üåº</span> –ú–∞–π</button>
    <button data-month="–ò—é–Ω—å"><span class="icon">‚òÄÔ∏è</span> –ò—é–Ω—å</button>
    <button data-month="–ò—é–ª—å"><span class="icon">üåª</span> –ò—é–ª—å</button>
    <button data-month="–ê–≤–≥—É—Å—Ç"><span class="icon">üèñÔ∏è</span> –ê–≤–≥—É—Å—Ç</button>
    <button data-month="–°–µ–Ω—Ç—è–±—Ä—å"><span class="icon">üçÇ</span> –°–µ–Ω—Ç—è–±—Ä—å</button>
    <button data-month="–û–∫—Ç—è–±—Ä—å"><span class="icon">üçÅ</span> –û–∫—Ç—è–±—Ä—å</button>
    <button data-month="–ù–æ—è–±—Ä—å"><span class="icon">üåßÔ∏è</span> –ù–æ—è–±—Ä—å</button>
    <button data-month="–î–µ–∫–∞–±—Ä—å"><span class="icon">üéÑ</span> –î–µ–∫–∞–±—Ä—å</button>
    <button id="salary-month-back" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = tg.initDataUnsafe.user || { first_name: "–ì–æ—Å—Ç—å" };
    const now = new Date();
    const hour = now.getHours();

    let greetingText = "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä";
    if (hour < 12) greetingText = "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ";
    else if (hour < 18) greetingText = "–î–æ–±—Ä—ã–π –¥–µ–Ω—å";

    document.getElementById("greeting").innerText = `${greetingText}, ${user.first_name}!`;

    // –ì–ª–∞–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∏ –±–ª–æ–∫–∏
    const mainButtons = document.getElementById("main-buttons");
    const lunchMenu = document.getElementById("lunch-menu");
    const vacationForm = document.getElementById("vacation-form");
    const salaryYear = document.getElementById("salary-year");
    const salaryMonth = document.getElementById("salary-month");

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –±–ª–æ–∫–æ–≤
    function showBlock(block) {
      [mainButtons, lunchMenu, vacationForm, salaryYear, salaryMonth].forEach(el => {
        el.classList.toggle("hidden", el !== block);
      });
    }

    // === –û–±–µ–¥ ===
    document.getElementById("lunch").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(lunchMenu);
    });

    document.getElementById("lunch-back").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(mainButtons);
    });

    lunchMenu.querySelectorAll("button[data-dish]").forEach(btn => {
      btn.addEventListener("click", () => {
        tg.HapticFeedback.impactOccurred("medium");
        tg.showAlert(`–í—ã –≤—ã–±—Ä–∞–ª–∏: ${btn.dataset.dish}`);
      });
    });

    // === –û—Ç–ø—É—Å–∫ ===
    document.getElementById("vacation").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(vacationForm);
      document.getElementById("vacation-error").classList.add("hidden");
      
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (—Å–µ–≥–æ–¥–Ω—è)
      const todayStr = new Date().toISOString().slice(0, 10);
      document.getElementById("start-date").value = "";
      document.getElementById("end-date").value = "";
      document.getElementById("start-date").min = todayStr;
      document.getElementById("end-date").min = todayStr;
    });

    document.getElementById("vacation-back").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(mainButtons);
    });

    document.getElementById("vacation-submit").addEventListener("click", () => {
      const start = document.getElementById("start-date").value;
      const end = document.getElementById("end-date").value;
      const error = document.getElementById("vacation-error");

      if (!start || !end) {
        error.innerText = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –¥–∞—Ç—ã";
        error.classList.remove("hidden");
        tg.HapticFeedback.notificationOccurred("error");
        return;
      }

      const startDate = new Date(start);
      const endDate = new Date(end);

      if (endDate < startDate) {
        error.innerText = "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞";
        error.classList.remove("hidden");
        tg.HapticFeedback.notificationOccurred("error");
        return;
      }

      const diffDays = (endDate - startDate) / (1000 * 60 * 60 * 24) + 1;

      if (diffDays > 14) {
        error.innerText = "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî 14 –¥–Ω–µ–π";
        error.classList.remove("hidden");
        tg.HapticFeedback.notificationOccurred("error");
        return;
      }

      tg.HapticFeedback.notificationOccurred("success");
      tg.showAlert(`–û—Ç–ø—É—Å–∫ —Å ${start} –ø–æ ${end} (${diffDays} –¥–Ω–µ–π) –ø—Ä–∏–Ω—è—Ç!`);
    });

    // === –ó–∞—Ä–ø–ª–∞—Ç–∞ ===
    document.getElementById("salary").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(salaryYear);
      renderYears();
    });

    document.getElementById("salary-year-back").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(mainButtons);
    });

    document.getElementById("salary-month-back").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      showBlock(salaryYear);
    });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≥–æ–¥–æ–≤
    function renderYears() {
      salaryYear.innerHTML = '';
      const currentYear = new Date().getFullYear();
      
      for (let y = currentYear; y >= currentYear - 9; y--) {
        const btn = document.createElement("button");
        btn.innerHTML = `<span class="icon">üìÖ</span> ${y}`;
        btn.addEventListener("click", () => {
          tg.HapticFeedback.impactOccurred("light");
          showBlock(salaryMonth);
          salaryMonth.dataset.year = y;
        });
        salaryYear.insertBefore(btn, document.getElementById("salary-year-back"));
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Å—è—Ü–∞
    salaryMonth.querySelectorAll("button[data-month]").forEach(btn => {
      btn.addEventListener("click", () => {
        const year = salaryMonth.dataset.year;
        tg.HapticFeedback.impactOccurred("medium");
        tg.showAlert(`–í—ã –≤—ã–±—Ä–∞–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—É –∑–∞ ${btn.dataset.month} ${year} –≥–æ–¥–∞`);
      });
    });

    // === –ß–∞—Ç ===
    document.getElementById("chat").addEventListener("click", () => {
      tg.HapticFeedback.impactOccurred("light");
      tg.showAlert("–ß–∞—Ç —Å HR –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏");
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    tg.onEvent('themeChanged', () => {
      document.body.style.backgroundColor = tg.themeParams.bg_color || '#F5F6FA';
      document.body.style.color = tg.themeParams.text_color || '#2D3436';
    });
  </script>
</body>
</html>
