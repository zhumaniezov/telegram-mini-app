<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞—Ä–ø–ª–∞—Ç–∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="info-screen">
  <div class="container">
    <h1>üí∞ –†–∞—Å—á–µ—Ç–Ω—ã–π –ª–∏—Å—Ç–æ–∫</h1>
    
    <div class="period-selector">
      <select id="year-select" class="period-select">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥</option>
      </select>
      
      <select id="month-select" class="period-select" disabled>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</option>
      </select>
      
      <button id="show-payslip" class="show-btn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å</button>
    </div>
    
    <div class="payslip" id="payslip" style="display: none;">
      <div class="employee-info">
        <h3 id="employee-name">–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á</h3>
        <p id="period">–ò—é–Ω—å 2023</p>
        <p id="employee-position">–î–æ–ª–∂–Ω–æ—Å—Ç—å: <span>–°—Ç–∞—Ä—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</span></p>
        <p id="employee-id">–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä: <span>EMP-12345</span></p>
      </div>
      
      <div class="salary-details">
        <h4>–ù–∞—á–∏—Å–ª–µ–Ω–∏—è</h4>
        <table class="details-table">
          <tr>
            <td>–û–∫–ª–∞–¥</td>
            <td id="salary-base">35 000 000 —Å—É–º</td>
          </tr>
          <tr>
            <td>–ü—Ä–µ–º–∏—è</td>
            <td id="salary-bonus">7 750 000 —Å—É–º</td>
          </tr>
          <tr>
            <td>–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏</td>
            <td id="salary-overtime">1 200 000 —Å—É–º</td>
          </tr>
          <tr class="subtotal">
            <td>–ò—Ç–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ</td>
            <td id="salary-accrued">42 750 000 —Å—É–º</td>
          </tr>
        </table>
        
        <h4>–£–¥–µ—Ä–∂–∞–Ω–∏—è</h4>
        <table class="details-table">
          <tr>
            <td>–ù–î–§–õ (12%)</td>
            <td id="tax-ndfl">1 530 000 —Å—É–º</td>
          </tr>
          <tr>
            <td>–ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–π –≤–∑–Ω–æ—Å (1%)</td>
            <td id="tax-pension">427 500 —Å—É–º</td>
          </tr>
          <tr>
            <td>–ü—Ä–æ—Ñ—Å–æ—é–∑–Ω—ã–π –≤–∑–Ω–æ—Å</td>
            <td id="tax-union">192 500 —Å—É–º</td>
          </tr>
          <tr class="subtotal">
            <td>–ò—Ç–æ–≥–æ —É–¥–µ—Ä–∂–∞–Ω–æ</td>
            <td id="salary-deductions">2 150 000 —Å—É–º</td>
          </tr>
        </table>
        
        <table class="total-table">
          <tr>
            <td>–ö –≤—ã–ø–ª–∞—Ç–µ:</td>
            <td id="salary-net">40 600 000 —Å—É–º</td>
          </tr>
        </table>
      </div>
      
      <div class="payslip-actions">
        <button id="download-pdf" class="download-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          –°–∫–∞—á–∞—Ç—å PDF
        </button>
        <button id="send-email" class="email-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email
        </button>
      </div>
    </div>
    
    <button onclick="window.location.href='main.html'" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è jsPDF
    const { jsPDF } = window.jspdf;
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≥–æ–¥–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ª–µ—Ç)
    const yearSelect = document.getElementById('year-select');
    const currentYear = new Date().getFullYear();
    for (let year = currentYear; year >= currentYear - 5; year--) {
      const option = document.createElement('option');
      option.value = year;
      option.textContent = year;
      yearSelect.appendChild(option);
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–µ—Å—è—Ü—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≥–æ–¥–∞
    yearSelect.addEventListener('change', function() {
      const monthSelect = document.getElementById('month-select');
      monthSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</option>';
      monthSelect.disabled = false;
      
      const months = [
        '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
      ];
      
      months.forEach((month, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = month;
        monthSelect.appendChild(option);
      });
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–µ—Å—è—Ü–∞
    document.getElementById('month-select').addEventListener('change', function() {
      document.getElementById('show-payslip').disabled = !this.value;
    });
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º—ã
    function formatSum(sum) {
      return sum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' —Å—É–º';
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    function generateSalaryData() {
      const base = Math.floor(Math.random() * 20 + 30) * 1000000; // 30-50 –º–ª–Ω
      const bonus = Math.floor(base * (0.15 + Math.random() * 0.1)); // 15-25%
      const overtime = Math.floor(base * (0.02 + Math.random() * 0.03)); // 2-5%
      const accrued = base + bonus + overtime;
      
      const ndfl = Math.floor(accrued * 0.12); // 12%
      const pension = Math.floor(accrued * 0.01); // 1%
      const union = Math.floor(accrued * 0.005); // 0.5%
      const deductions = ndfl + pension + union;
      
      const net = accrued - deductions;
      
      return {
        base,
        bonus,
        overtime,
        accrued,
        ndfl,
        pension,
        union,
        deductions,
        net
      };
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ –ª–∏—Å—Ç–∫–∞
    document.getElementById('show-payslip').addEventListener('click', function() {
      const year = document.getElementById('year-select').value;
      const monthIndex = document.getElementById('month-select').value;
      const months = [
        '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
      ];
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–∏–æ–¥
      document.getElementById('period').textContent = `${months[monthIndex]} ${year}`;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
      const salaryData = generateSalaryData();
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
      document.getElementById('salary-base').textContent = formatSum(salaryData.base);
      document.getElementById('salary-bonus').textContent = formatSum(salaryData.bonus);
      document.getElementById('salary-overtime').textContent = formatSum(salaryData.overtime);
      document.getElementById('salary-accrued').textContent = formatSum(salaryData.accrued);
      document.getElementById('tax-ndfl').textContent = formatSum(salaryData.ndfl);
      document.getElementById('tax-pension').textContent = formatSum(salaryData.pension);
      document.getElementById('tax-union').textContent = formatSum(salaryData.union);
      document.getElementById('salary-deductions').textContent = formatSum(salaryData.deductions);
      document.getElementById('salary-net').textContent = formatSum(salaryData.net);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—á–µ—Ç–Ω—ã–π –ª–∏—Å—Ç–æ–∫
      document.getElementById('payslip').style.display = 'block';
    });
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
    document.getElementById('download-pdf').addEventListener('click', function() {
      const doc = new jsPDF();
      const month = document.getElementById('period').textContent;
      const name = document.getElementById('employee-name').textContent;
      const position = document.getElementById('employee-position span').textContent;
      const empId = document.getElementById('employee-id span').textContent;
      
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫
      doc.setFontSize(16);
      doc.setTextColor(40);
      doc.text('–†–∞—Å—á–µ—Ç–Ω—ã–π –ª–∏—Å—Ç–æ–∫', 105, 20, { align: 'center' });
      
      doc.setFontSize(12);
      doc.text(`–ó–∞ ${month}`, 105, 28, { align: 'center' });
      
      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
      doc.setFontSize(10);
      doc.text(`–°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${name}`, 14, 40);
      doc.text(`–î–æ–ª–∂–Ω–æ—Å—Ç—å: ${position}`, 14, 46);
      doc.text(`–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä: ${empId}`, 14, 52);
      
      // –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
      doc.autoTable({
        startY: 60,
        head: [['–ù–∞—á–∏—Å–ª–µ–Ω–∏—è', '–°—É–º–º–∞ (—Å—É–º)']],
        body: [
          ['–û–∫–ª–∞–¥', document.getElementById('salary-base').textContent],
          ['–ü—Ä–µ–º–∏—è', document.getElementById('salary-bonus').textContent],
          ['–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏', document.getElementById('salary-overtime').textContent],
          ['–ò—Ç–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ', document.getElementById('salary-accrued').textContent]
        ],
        headStyles: {
          fillColor: [255, 160, 0],
          textColor: [0, 0, 0],
          fontStyle: 'bold'
        },
        styles: {
          cellPadding: 5,
          fontSize: 10
        }
      });
      
      // –¢–∞–±–ª–∏—Ü–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–π
      doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [['–£–¥–µ—Ä–∂–∞–Ω–∏—è', '–°—É–º–º–∞ (—Å—É–º)']],
        body: [
          ['–ù–î–§–õ (12%)', document.getElementById('tax-ndfl').textContent],
          ['–ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–π –≤–∑–Ω–æ—Å (1%)', document.getElementById('tax-pension').textContent],
          ['–ü—Ä–æ—Ñ—Å–æ—é–∑–Ω—ã–π –≤–∑–Ω–æ—Å', document.getElementById('tax-union').textContent],
          ['–ò—Ç–æ–≥–æ —É–¥–µ—Ä–∂–∞–Ω–æ', document.getElementById('salary-deductions').textContent]
        ],
        headStyles: {
          fillColor: [255, 160, 0],
          textColor: [0, 0, 0],
          fontStyle: 'bold'
        },
        styles: {
          cellPadding: 5,
          fontSize: 10
        }
      });
      
      // –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text(`–ö –≤—ã–ø–ª–∞—Ç–µ: ${document.getElementById('salary-net').textContent}`, 14, doc.lastAutoTable.finalY + 20);
      
      // –ü–æ–¥–ø–∏—Å—å –∏ –¥–∞—Ç–∞
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.text('–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è:', 14, doc.lastAutoTable.finalY + 40);
      doc.text(new Date().toLocaleDateString('ru-RU'), 60, doc.lastAutoTable.finalY + 40);
      
      doc.text('–ü–æ–¥–ø–∏—Å—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–∏—Ü–∞:', 105, doc.lastAutoTable.finalY + 40, { align: 'right' });
      doc.line(150, doc.lastAutoTable.finalY + 43, 190, doc.lastAutoTable.finalY + 43);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
      doc.save(`–†–∞—Å—á–µ—Ç–Ω—ã–π_–ª–∏—Å—Ç–æ–∫_${name}_${month.replace(' ', '_')}.pdf`);
    });
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ email (–∑–∞–≥–ª—É—à–∫–∞)
    document.getElementById('send-email').addEventListener('click', function() {
      alert('–†–∞—Å—á–µ—Ç–Ω—ã–π –ª–∏—Å—Ç–æ–∫ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–æ—á—Ç—É');
    });
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ Telegram
    if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
      const user = window.Telegram.WebApp.initDataUnsafe.user;
      const userName = [user.last_name, user.first_name].filter(Boolean).join(' ') || '–°–æ—Ç—Ä—É–¥–Ω–∏–∫';
      document.getElementById('employee-name').textContent = userName;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∏ —Ç–∞–±–µ–ª—å–Ω–æ–º –Ω–æ–º–µ—Ä–µ
      const positions = ['–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', '–°—Ç–∞—Ä—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', '–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫', '–ê–Ω–∞–ª–∏—Ç–∏–∫', '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤'];
      document.getElementById('employee-position span').textContent = positions[Math.floor(Math.random() * positions.length)];
      document.getElementById('employee-id span').textContent = `EMP-${Math.floor(10000 + Math.random() * 90000)}`;
    }
  </script>
</body>
</html>
